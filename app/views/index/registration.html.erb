
<style type="text/css">
	.wrap-checkbox{
		width: 45%;
	}
	.second-block{
		margin-left: 50%;
	}
	.first-block{
		float: left;
	}
</style>

<%= form_tag("/index/create") do %>
  <% if @user.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:</h2>

      <ul>
      <% @user.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= label_tag :email %><br />
    <input type="text" name="user[email]">
  </div>
  <div class="field">
    <%= label_tag :phone %><br />
    <input type="text" name="user[phone]">
  </div>
  <div class="field">
    <%= label_tag :category %><br />
    <input type="hidden" class="hidden_category" name="user[category]">
    <div class="category_section"></div>
    <div class="select-category">
    	<select>
    		<% Category.all.each do |f| %>
    			<option value="<%= f.id %>"><%= f.name %></option>
    		<% end %>
    	</select>
    	<button class="add-category">Add category</button>
    </div>
  </div>
  <div class="field">
    <%= label_tag :city %><br />
    <input type="text" name="user[city]">
  </div>
  <div class="first-block wrap-checkbox">
  	  <div class="field">
	    <%= label_tag :create_videos %><br />
	    <input type="checkbox" checked name="anketa[create_videos]">
	  </div>
	  <div class="field">
	    <%= label_tag :making_channel_toghether %><br />
	    <input type="checkbox" checked name="anketa[making_channel_toghether]">
	  </div>
	  <div class="field">
	    <%= label_tag :cross_promotions_and_email_lists %><br />
	    <input type="checkbox" checked name="anketa[cross_promotions_and_email_lists]">
	  </div>
	  <div class="field">
	    <%= label_tag :recommended_channel_swapping %><br />
	    <input type="checkbox" checked name="anketa[recommended_channel_swapping]">
	  </div>
	  <div class="field">
	    <%= label_tag :annotation_or_end_card_or_link_swapping %><br />
	    <input type="checkbox" checked name="anketa[annotation_or_end_card_or_link_swapping]">
	  </div>
	  <div class="field">
	    <%= label_tag :open_to_other_types %><br />
	    <input type="checkbox" checked name="anketa[open_to_other_types]">
	  </div>
	  <div class="field not-interested">
	  	<label>Not interesting</label>
		<input type="checkbox" class="signup-form-not_interested">
	  </div>
  </div>

  <div class="second-block wrap-checkbox">
  	  <div class="field">
	    <%= label_tag :brand_product_integration %><br />
	    <input type="checkbox" checked name="anketa[brand_product_integration]">
	  </div>
	  <div class="field">
	    <%= label_tag :product_reviews %><br />
	    <input type="checkbox" checked name="anketa[product_reviews]">
	  </div>
	  <div class="field">
	    <%= label_tag :dedicated_videos %><br />
	    <input type="checkbox" checked name="anketa[dedicated_videos]">
	  </div>
	  <div class="field">
	    <%= label_tag :revenue_affiliate %><br />
	    <input type="checkbox" checked name="anketa[revenue_affiliate]">
	  </div>
	  <div class="field">
	    <%= label_tag :spokesperson %><br />
	    <input type="checkbox" checked name="anketa[spokesperson]">
	  </div>
	  <div class="field">
	    <%= label_tag :offyoutube_promotion %><br />
	    <input type="checkbox" checked name="anketa[offyoutube_promotion]">
	  </div>
	  <div class="field">
	    <%= label_tag :including_brand_videos %><br />
	    <input type="checkbox" checked name="anketa[including_brand_videos]">
	  </div>
	  <div class="field">
	    <%= label_tag :open_to_other_types %><br />
	    <input type="checkbox" checked name="anketa[open_to_other_types]">
	  </div>
	  <div class="field not-interested">
	  	<label>Not interesting</label>
		<input type="checkbox" class="signup-form-not_interested">
	  </div>
  </div>

  <div class="actions">
    <%= submit_tag %>
  </div>
<% end %>

<script type="text/javascript">
	$(".signup-form-not_interested").change(function(){
		$(this).parents(".wrap-checkbox").find("input[type='checkbox']").removeAttr("checked");
		$(this).prop('checked', true);
	})

	$("input[type='checkbox']").change(function(){
		if($(this).attr("class")!="signup-form-not_interested"){
			$(this).parents(".wrap-checkbox").find(".signup-form-not_interested").prop('checked', false);
		}
	})

	$(".add-category").click(function(e){
		e.preventDefault();
		valId=$(this).parents(".select-category").find("select option:selected");
		val=$(".hidden_category").val();
		if(!val || !val.split(",") || val.split(",").indexOf("id"+valId.val()) < 0){
			$(".hidden_category").val(val+"id"+valId.val()+",");
			$(".category_section").append("<span class='selected-category-item' data-id='"+valId.val()+"'>"+valId.text()+" <span onclick='destroy_category(this)'>Удалить</span> </span>")
		}
	})

	function destroy_category(ths){
		th=jQuery(ths);
		parentWrap=th.parents(".selected-category-item");
		id=parentWrap.data("id");
		parentWrap.remove();
		val=$(".hidden_category").val();
		splitedStr=val.split(",");
		splitedStr=jQuery.grep(splitedStr, function(value) {
		  return value != "id"+id;
		});
		if(splitedStr.length>0)
			str=splitedStr.join(",");
		else
			str="";

		$(".hidden_category").val(str);
	}
</script>